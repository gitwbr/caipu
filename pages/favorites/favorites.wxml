<view class="page">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="page-title">我的收藏</view>
    <view class="page-subtitle">收藏的菜谱都在这里</view>
    <!-- 登录状态显示 -->
    <view class="login-status" wx:if="{{!isLoggedIn}}">
      <text>请先登录查看收藏</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <view class="loading-text">加载中...</view>
  </view>

  <!-- 收藏列表 -->
  <view class="favorites-list" wx:if="{{favorites.length > 0 && !isLoading}}">
    <view 
      wx:for="{{favorites}}" 
      wx:key="favoriteId"
      class="favorite-item"
      bindtap="viewRecipe"
      data-recipe="{{item}}"
    >
      <!-- 右上角删除按钮（阻止冒泡） -->
      <view class="card-delete" catchtap="removeFavorite" data-id="{{item.favoriteId}}">🗑️</view>
      <!-- 上：左图右文 -->
      <view class="card-top">
        <view class="record-thumb">
          <image wx:if="{{item.image_full_url}}" class="thumb" src="{{item.image_full_url}}" mode="aspectFill" lazy-load />
          <text wx:else class="thumb-placeholder">🍽️</text>
        </view>
        <view class="top-info">
          <view class="recipe-name">{{item.name}}</view>
          <view class="recipe-desc">{{item.description}}</view>
        </view>
      </view>

      <!-- 中：左热量，右侧箭头（保持不变）+ 删除按钮 -->
      <view class="card-middle">
        <view class="calorie-row">
          <view class="calorie-badge">
            <text class="calorie-icon">🔥</text>
            <text class="calorie-value">{{item.calorie_display}}</text>
          </view>
        </view>
        <view class="recipe-actions">
          <view class="recipe-arrow">></view>
        </view>
      </view>

      <!-- 下：标签（样式不动） -->
      <view class="card-bottom">
        <view class="recipe-tags">
          <view class="tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="idx">{{tag}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{favorites.length === 0 && !isLoading && isLoggedIn}}">
    <view class="empty-icon">❤️</view>
    <view class="empty-title">还没有收藏的菜谱</view>
    <view class="empty-desc">去首页生成一些美味的菜谱吧</view>
    <button class="btn-primary" bindtap="goToHome">去生成菜谱</button>
  </view>

  <!-- 未登录状态 -->
  <view class="empty-state" wx:if="{{!isLoggedIn && !isLoading}}">
    <view class="empty-icon">🔐</view>
    <view class="empty-title">需要登录</view>
    <view class="empty-desc">登录后才能查看和管理收藏</view>
    <button class="btn-primary" bindtap="showLoginModal">微信一键登录</button>
  </view>

  
</view> 