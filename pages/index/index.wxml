<view class="page">
  <!-- 头部标题 -->
  <view class="header">
    <view class="title">健康饮食助手（AI版）</view>
    <view class="subtitle">让AI为您生成美味菜谱</view>
  </view>

  <!-- 顶部标签页 -->
  <view class="tabs">
    <view class="tab-item {{activeTab === 0 ? 'active' : ''}}" bindtap="onTabChange" data-index="0">食材</view>
    <view class="tab-item {{activeTab === 1 ? 'active' : ''}}" bindtap="onTabChange" data-index="1">菜品类型</view>
    <view class="tab-item {{activeTab === 2 ? 'active' : ''}}" bindtap="onTabChange" data-index="2">菜系风格</view>
    <view class="tab-item {{activeTab === 3 ? 'active' : ''}}" bindtap="onTabChange" data-index="3">烹饪方式</view>
  </view>

  <!-- 选择区域卡片 -->
  <view class="card">
    <view class="card-content">
      <!-- 食材多选，横向tab切换大类 -->
      <view wx:if="{{activeTab === 0}}">
        <view class="ingredient-tabs">
          <block wx:for="{{ingredientCategoryTabs}}" wx:key="index">
            <view class="ingredient-tab {{activeIngredientCategoryTab == index ? 'active' : ''}}"
                  data-index="{{index}}"
                  bindtap="onIngredientCategoryTabChange">
              {{item}}
            </view>
          </block>
        </view>
        <view class="category-group">
          <view class="category-title">{{categorizedIngredients[activeIngredientCategoryTab].categoryName}}</view>
          <view class="multi-select-list">
            <block wx:for="{{categorizedIngredients[activeIngredientCategoryTab].ingredients}}" wx:key="name">
              <view class="multi-select-item {{item.selected ? 'selected' : ''}}"
                    bindtap="onIngredientTagTap"
                    data-category-index="{{activeIngredientCategoryTab}}"
                    data-ingredient-index="{{index}}">
                {{item.name}}
              </view>
            </block>
          </view>
        </view>
      </view>
      <!-- 新增：大类单选 -->
      <view wx:if="{{activeTab === 1}}">
        <view class="form-label">选择大类（可不选）</view>
        <view class="single-select-list">
          <view
            wx:for="{{dishTypeNames}}"
            wx:key="index"
            class="single-select-item {{selectedDishTypeIndex === index ? 'selected' : ''}}"
            bindtap="onDishTypeTagTap"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </view>
      </view>
      <!-- 菜系/种类单选 -->
      <view wx:if="{{activeTab === 2}}">
        <view class="form-label">选择菜系（可不选，默认为家常菜）</view>
        <view class="single-select-list">
          <view
            wx:for="{{typeNames}}"
            wx:key="index"
            class="single-select-item {{selectedTypeIndex === index ? 'selected' : ''}}"
            bindtap="onTypeTagTap"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </view>
      </view>
      <!-- 烹饪方式单选 -->
      <view wx:if="{{activeTab === 3}}">
        <view class="form-label">选择烹饪方式（可不选）</view>
        <view class="single-select-list">
          <view
            wx:for="{{methodNames}}"
            wx:key="index"
            class="single-select-item {{selectedMethodIndex === index ? 'selected' : ''}}"
            bindtap="onMethodTagTap"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 生成按钮 -->
  <view class="generate-btn-wrapper">
    <button class="btn-primary big" bindtap="onGenerateRecipe">生成菜谱</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <view class="loading-text">AI正在为您生成菜谱...</view>
  </view>

  <!-- 最近生成的菜谱 -->
  <view class="card" wx:if="{{recentRecipes.length > 0}}">
    <view class="card-title">最近生成</view>
    <view class="card-content">
      <view 
        wx:for="{{recentRecipes}}" 
        wx:key="index"
        class="recipe-item"
        bindtap="viewRecipe"
        data-recipe="{{item}}"
      >
        <view class="recipe-info">
          <view class="recipe-name">{{item.name}}</view>
          <view class="recipe-desc">{{item.description}}</view>
          <view class="recipe-tags">
            <view class="tag" wx:for="{{item.tags}}" wx:key="tagIndex">{{item}}</view>
          </view>
        </view>
        <view class="recipe-arrow">></view>
      </view>
    </view>
  </view>
</view> 