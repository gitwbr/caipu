<view class="page">
  <!-- å¤´éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <view class="title">å¥åº·é¥®é£ŸåŠ©æ‰‹ï¼ˆAIç‰ˆï¼‰</view>
    <view class="subtitle">è®©AIä¸ºæ‚¨ç”Ÿæˆç¾å‘³èœè°±</view>
  </view>

  <!-- é¡¶éƒ¨æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab-item {{activeTab === 0 ? 'active' : ''}}" bindtap="onTabChange" data-index="0">é£Ÿæ</view>
    <view class="tab-item {{activeTab === 1 ? 'active' : ''}}" bindtap="onTabChange" data-index="1">èœå“ç±»å‹</view>
    <view class="tab-item {{activeTab === 2 ? 'active' : ''}}" bindtap="onTabChange" data-index="2">èœç³»é£æ ¼</view>
    <view class="tab-item {{activeTab === 3 ? 'active' : ''}}" bindtap="onTabChange" data-index="3">çƒ¹é¥ªæ–¹å¼</view>
  </view>

  <!-- é€‰æ‹©åŒºåŸŸå¡ç‰‡ -->
  <view class="card">
    <view class="card-content">
      <!-- é£Ÿæå¤šé€‰ï¼Œæ¨ªå‘tabåˆ‡æ¢å¤§ç±» -->
      <view wx:if="{{activeTab === 0}}">
        <view class="ingredient-tabs">
          <block wx:for="{{ingredientCategoryTabs}}" wx:key="index">
            <view class="ingredient-tab {{activeIngredientCategoryTab == index ? 'active' : ''}}"
                  data-index="{{index}}"
                  bindtap="onIngredientCategoryTabChange">
              {{item}}
            </view>
          </block>
        </view>
        <view class="category-group">
          <view class="category-title">{{categorizedIngredients[activeIngredientCategoryTab].categoryName}}</view>
          <view class="multi-select-list">
            <block wx:for="{{categorizedIngredients[activeIngredientCategoryTab].ingredients}}" wx:key="name">
              <view class="multi-select-item {{item.selected ? 'selected' : ''}}"
                    bindtap="onIngredientTagTap"
                    data-category-index="{{activeIngredientCategoryTab}}"
                    data-ingredient-index="{{index}}">
                {{item.name}}
              </view>
            </block>
          </view>
        </view>
      </view>
      <!-- æ–°å¢ï¼šå¤§ç±»å•é€‰ -->
      <view wx:if="{{activeTab === 1}}">
        <view class="form-label">é€‰æ‹©å¤§ç±»ï¼ˆå¯ä¸é€‰ï¼‰</view>
        <view class="single-select-list">
          <view
            wx:for="{{dishTypeNames}}"
            wx:key="index"
            class="single-select-item {{selectedDishTypeIndex === index ? 'selected' : ''}}"
            bindtap="onDishTypeTagTap"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </view>
      </view>
      <!-- èœç³»/ç§ç±»å•é€‰ -->
      <view wx:if="{{activeTab === 2}}">
        <view class="form-label">é€‰æ‹©èœç³»ï¼ˆå¯ä¸é€‰ï¼Œé»˜è®¤ä¸ºå®¶å¸¸èœï¼‰</view>
        <view class="single-select-list">
          <view
            wx:for="{{typeNames}}"
            wx:key="index"
            class="single-select-item {{selectedTypeIndex === index ? 'selected' : ''}}"
            bindtap="onTypeTagTap"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </view>
      </view>
      <!-- çƒ¹é¥ªæ–¹å¼å•é€‰ -->
      <view wx:if="{{activeTab === 3}}">
        <view class="form-label">é€‰æ‹©çƒ¹é¥ªæ–¹å¼ï¼ˆå¯ä¸é€‰ï¼‰</view>
        <view class="single-select-list">
          <view
            wx:for="{{methodNames}}"
            wx:key="index"
            class="single-select-item {{selectedMethodIndex === index ? 'selected' : ''}}"
            bindtap="onMethodTagTap"
            data-index="{{index}}"
          >
            {{item}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å·²é€‰å†…å®¹å±•ç¤º -->
  <view wx:if="{{selectedIngredientNames.length > 0 || selectedDishTypeName || selectedTypeName || selectedMethodName}}" class="selected-ingredients-bar">
    <scroll-view scroll-x="true" class="selected-ingredients-list">
      <block wx:if="{{selectedIngredientNames.length > 0}}">
        <view class="selected-ingredients-label">å·²é€‰é£Ÿæï¼š</view>
        <block wx:for="{{selectedIngredientNames}}" wx:key="name">
          <view class="selected-ingredient-tag">{{item}}</view>
        </block>
      </block>
      <block wx:if="{{selectedDishTypeName}}">
        <view class="selected-ingredients-label">ç±»å‹ï¼š</view>
        <view class="selected-ingredient-tag">{{selectedDishTypeName}}</view>
      </block>
      <block wx:if="{{selectedTypeName}}">
        <view class="selected-ingredients-label">èœç³»ï¼š</view>
        <view class="selected-ingredient-tag">{{selectedTypeName}}</view>
      </block>
      <block wx:if="{{selectedMethodName}}">
        <view class="selected-ingredients-label">æ–¹å¼ï¼š</view>
        <view class="selected-ingredient-tag">{{selectedMethodName}}</view>
      </block>
    </scroll-view>
    <view class="clear-selected-btn" bindtap="onClearAllSelections">ğŸ—‘ï¸</view>
  </view>

  <!-- ç”ŸæˆæŒ‰é’® -->
  <view class="generate-btn-wrapper">
    <button class="btn-primary big" bindtap="onGenerateRecipe">ç”Ÿæˆèœè°±</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <view class="loading-text">AIæ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆèœè°±...</view>
  </view>

  <!-- æœ€è¿‘ç”Ÿæˆçš„èœè°± -->
  <view class="card" wx:if="{{recentRecipes.length > 0}}">
    <view class="card-title">æœ€è¿‘ç”Ÿæˆ</view>
    <view class="card-content">
      <view 
        wx:for="{{recentRecipes}}" 
        wx:key="index"
        class="recipe-item"
        bindtap="viewRecipe"
        data-recipe="{{item}}"
      >
        <view class="recipe-info">
          <view class="recipe-name">{{item.name}}</view>
          <view class="recipe-desc">{{item.description}}</view>
          <view class="recipe-tags">
            <view class="tag" wx:for="{{item.tags}}" wx:key="tagIndex">{{item}}</view>
          </view>
        </view>
        <view class="recipe-arrow">></view>
      </view>
    </view>
  </view>
</view> 