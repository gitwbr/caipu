<!--pages/profile/profile.wxml-->
<view class="container">
  <view class="profile-header">
    <button class="edit-btn" type="default" size="mini" bindtap="editUserInfo" wx:if="{{isLoggedIn}}">编辑个人资料</button>
  </view>
  
  <view class="profile-info">
    <image class="avatar" src="{{localAvatar || '/images/profile.png'}}" mode="aspectFit"></image>
    <text class="nickname">
      {{
        !isLoggedIn ? '未登录' :
        (userInfo && userInfo.nickname ? userInfo.nickname : '微信用户')
      }}
    </text>
    <text class="login-status" wx:if="{{isLoggedIn}}">已登录</text>
  </view>

  <!-- 登录/登出按钮 -->
  <view class="auth-buttons">
    <button type="primary" class="login-btn" bindtap="handleLogin" wx:if="{{!isLoggedIn}}">微信一键登录</button>
    <button type="warn" class="logout-btn" bindtap="handleLogout" wx:if="{{isLoggedIn}}">退出登录</button>
  </view>

  <!-- 身体信息 -->
  <view class="body-info" wx:if="{{isLoggedIn && userInfo}}">
    <view class="info-section">
      <text class="section-title">身体信息</text>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">身高</text>
          <text class="info-value">{{userInfo.height_cm || '未设置'}} cm</text>
        </view>
        <view class="info-item">
          <text class="info-label">体重</text>
          <text class="info-value">{{userInfo.weight_kg || '未设置'}} kg</text>
        </view>
        <view class="info-item">
          <text class="info-label">生日</text>
          <text class="info-value">{{formattedBirthday || '未设置'}}{{calculatedAge ? ' (' + calculatedAge + '岁)' : ''}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">性别</text>
          <text class="info-value">{{userInfo.gender === 'male' ? '男' : (userInfo.gender === 'female' ? '女' : '未设置')}}</text>
        </view>
      </view>
    </view>
    
    <view class="bmr-section" wx:if="{{userInfo.height_cm && userInfo.weight_kg && userInfo.birthday && userInfo.gender}}">
      <text class="section-title">基础代谢率 (BMR)</text>
      <text class="bmr-value">{{bmr}} kcal/天</text>
      <text class="bmr-desc">这是您每日的基础卡路里需求</text>
    </view>
  </view>

  <view class="menu-list">
    <view class="menu-item">
      <text>关于我们</text>
      <text class="arrow">></text>
    </view>
  </view>
</view> 