<!--pages/record/add-record.wxml-->
<view class="container">
  <!-- 搜索框 -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="请输入食物名称" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
    </view>
    <button class="search-btn" bindtap="onSearchBtnTap" style="width: 76rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 0rpx">
      <text class="search-btn-text">🔍</text>
    </button>
  </view>

  <!-- 操作条：营养识别 + 快速记录（放在搜索框下方） -->
  <view class="bottom-actions">
    <button class="ocr-btn" bindtap="takePhoto">
      <text class="ocr-icon">📷</text>
      <text class="ocr-text">营养成分表识别</text>
    </button>
    <button class="quick-btn" bindtap="goQuickRecord">
      <text class="quick-icon">⚡</text>
      <text class="quick-text">快速记录</text>
    </button>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 左侧菜单（真实显示） -->
    <view class="sidebar">
      <view 
        class="menu-item {{activeTab === 'recent' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="recent"
      >
        <text class="menu-text">最近</text>
      </view>
      <view 
        class="menu-item {{activeTab === 'custom' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="custom"
      >
        <text class="menu-text">自定义</text>
      </view>
      <!-- 新增：收藏菜谱菜单项 -->
      <view 
        class="menu-item {{activeTab === 'favorites' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="favorites"
      >
        <text class="menu-text">收藏菜谱</text>
      </view>
    </view>

    <!-- 右侧内容区域 -->
    <view class="content-area">
      <!-- 搜索结果 -->
      <view class="search-results" wx:if="{{searchResults.length > 0}}">
        <view class="section-title">搜索结果</view>
        <view class="food-list">
          <view 
            class="food-item" 
            wx:for="{{searchResults}}" 
            wx:key="id" 
            bindtap="selectFood" 
            data-food="{{item}}"
          >
            <view class="food-image">
              <text class="food-placeholder">🍽️</text>
            </view>
            <view class="food-info">
              <text class="food-name">{{item.display_name}}</text>
              <text class="food-calories">{{item.display_energy_kcal}} kcal/100g</text>
            </view>
            <view class="food-add">+</view>
          </view>
        </view>
      </view>

      <!-- 最近食物 -->
      <view class="recent-foods" wx:if="{{activeTab === 'recent' && recentFoods.length > 0 && searchResults.length === 0}}">
        <view class="section-title">最近选择</view>
        <view class="food-list">
          <view 
            class="food-item" 
            wx:for="{{recentFoods}}" 
            wx:key="id" 
            bindtap="selectFood" 
            data-food="{{item}}"
          >
            <view class="food-image">
              <image 
                wx:if="{{item.image_url}}" 
                class="food-thumbnail" 
                 src="{{item.image_full_url}}" 
                 mode="aspectFill"
                 lazy-load
                data-src="{{item.image_full_url}}"
                data-origin="recent"
                binderror="onImgError"
                bindload="onImgLoad"
              />
              <text wx:else class="food-placeholder">🍽️</text>
            </view>
            <view class="food-info">
              <text class="food-name">{{item.display_name}}</text>
              <text class="food-calories">{{item.display_energy_kcal}} kcal/100g</text>
            </view>
            <view class="food-add">+</view>
          </view>
        </view>
      </view>

      <!-- 自定义食物 -->
      <view class="custom-foods" wx:if="{{activeTab === 'custom' && searchResults.length === 0}}">
        <view class="section-header">
          <text class="section-title">我的自定义食物</text>
          <view class="add-inline" bindtap="addCustomFood">
            <view class="icon-circle success small">＋</view>
            <text class="add-hint">添加自定义食物</text>
          </view>
        </view>
        
        <view class="food-list" wx:if="{{customFoods.length > 0}}">
          <view 
            class="food-item custom-food-item" 
            wx:for="{{customFoods}}" 
            wx:key="id"
            bindtap="selectFood" 
            data-food="{{item}}"
          >
            <view class="food-image">
              <image 
                wx:if="{{item.image_url}}" 
                class="food-thumbnail" 
                 src="{{item.image_full_url}}" 
                 mode="aspectFill"
                 lazy-load
                data-src="{{item.image_full_url}}"
                data-origin="custom"
                binderror="onImgError"
                bindload="onImgLoad"
              />
              <text wx:else class="food-placeholder">🍽️</text>
            </view>
            <view class="food-info">
              <text class="food-name">{{item.food_name}}</text>
              <text class="food-calories">{{item.energy_kcal}} kcal/100g</text>
            </view>
            <view class="food-actions" catchtap="stopPropagation">
              <view class="icon-circle danger" catchtap="deleteCustomFood" data-id="{{item.id}}">🗑️</view>
            </view>
          </view>
        </view>
        
        <view class="empty-state" wx:else>
          <text class="empty-text">暂无自定义食物</text>
          <text class="empty-hint">点击上方按钮添加自定义食物</text>
        </view>
      </view>

      <!-- 新增：收藏菜谱列表 -->
      <view class="favorites-list" wx:if="{{activeTab === 'favorites' && searchResults.length === 0}}">
        <view class="section-title">我的收藏菜谱</view>
        <view class="food-list" wx:if="{{favoriteRecipes.length > 0}}">
          <view class="food-item" wx:for="{{favoriteRecipes}}" wx:key="id" bindtap="openFavoriteRecipe" data-recipe="{{item}}">
            <view class="food-image">
              <image wx:if="{{item.image_url}}" class="food-thumbnail" src="{{item.image_full_url}}" mode="aspectFill" lazy-load />
              <text wx:else class="food-placeholder">🍽️</text>
            </view>
            <view class="food-info">
              <text class="food-name">{{item.name}}</text>
              <text class="food-calories text-muted">{{item.calorie_display || ''}}</text>
            </view>
            <view class="food-add">></view>
          </view>
        </view>
        <view class="empty-state" wx:else>
          <text class="empty-text">暂无收藏菜谱</text>
          <text class="empty-hint">去首页生成并收藏后，这里会显示</text>
        </view>
      </view>

      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{activeTab === 'recent' && recentFoods.length === 0 && searchResults.length === 0}}">
        <text class="empty-text">暂无最近选择</text>
        <text class="empty-hint">搜索并选择食物后，会显示在这里</text>
      </view>

      <!-- 搜索中状态 -->
      <view class="loading" wx:if="{{searching}}">
        <text>搜索中...</text>
      </view>
    </view>
  </view>

</view>