<!--pages/record/add-record.wxml-->
<view class="container">
  <!-- æœç´¢æ¡†å’Œæ‹ç…§æŒ‰é’® -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢é£Ÿç‰©..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
    <button class="camera-btn" bindtap="takePhoto">
      <text class="camera-icon">ğŸ“·</text>
    </button>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 'recent' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="recent"
    >
      <text class="tab-text">æœ€è¿‘</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'custom' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="custom"
    >
      <text class="tab-text">è‡ªå®šä¹‰</text>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results" wx:if="{{searchResults.length > 0}}">
    <view class="section-title">æœç´¢ç»“æœ</view>
    <view class="food-list">
      <view 
        class="food-item" 
        wx:for="{{searchResults}}" 
        wx:key="id" 
        bindtap="selectFood" 
        data-food="{{item}}"
      >
        <view class="food-info">
          <text class="food-name">{{item.display_name}}</text>
          <text class="food-type">{{item.type === 'standard' ? 'æ ‡å‡†' : 'è‡ªå®šä¹‰'}}</text>
        </view>
        <view class="food-calories">
          <text class="calories-text">{{item.display_energy_kcal}} kcal/100g</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘é£Ÿç‰© -->
  <view class="recent-foods" wx:if="{{activeTab === 'recent' && recentFoods.length > 0 && searchResults.length === 0}}">
    <view class="section-title">æœ€è¿‘é€‰æ‹©</view>
    <view class="food-list">
      <view 
        class="food-item" 
        wx:for="{{recentFoods}}" 
        wx:key="id" 
        bindtap="selectFood" 
        data-food="{{item}}"
      >
        <view class="food-info">
          <text class="food-name">{{item.display_name}}</text>
          <text class="food-type">{{item.type === 'standard' ? 'æ ‡å‡†' : 'è‡ªå®šä¹‰'}}</text>
        </view>
        <view class="food-calories">
          <text class="calories-text">{{item.display_energy_kcal}} kcal/100g</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰é£Ÿç‰© -->
  <view class="custom-foods" wx:if="{{activeTab === 'custom' && searchResults.length === 0}}">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„è‡ªå®šä¹‰é£Ÿç‰©</text>
      <button class="add-custom-btn" bindtap="addCustomFood">æ·»åŠ </button>
    </view>
    
    <view class="food-list" wx:if="{{customFoods.length > 0}}">
      <view 
        class="food-item custom-food-item" 
        wx:for="{{customFoods}}" 
        wx:key="id"
        bindtap="selectFood" 
        data-food="{{item}}"
      >
        <view class="food-info">
          <text class="food-name">{{item.food_name}}</text>
          <text class="food-type">è‡ªå®šä¹‰</text>
        </view>
        <view class="food-calories">
          <text class="calories-text">{{item.energy_kcal}} kcal/100g</text>
        </view>
        <view class="food-actions" catchtap="stopPropagation">
          <button class="action-btn edit-btn" catchtap="editCustomFood" data-food="{{item}}">ç¼–è¾‘</button>
          <button class="action-btn delete-btn" catchtap="deleteCustomFood" data-id="{{item.id}}">åˆ é™¤</button>
        </view>
      </view>
    </view>
    
    <view class="empty-state" wx:else>
      <text class="empty-text">æš‚æ— è‡ªå®šä¹‰é£Ÿç‰©</text>
      <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ è‡ªå®šä¹‰é£Ÿç‰©</text>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{activeTab === 'recent' && recentFoods.length === 0 && searchResults.length === 0}}">
    <text class="empty-text">æš‚æ— æœ€è¿‘é€‰æ‹©</text>
    <text class="empty-hint">æœç´¢å¹¶é€‰æ‹©é£Ÿç‰©åï¼Œä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
  </view>

  <!-- æœç´¢ä¸­çŠ¶æ€ -->
  <view class="loading" wx:if="{{searching}}">
    <text>æœç´¢ä¸­...</text>
  </view>
</view>