<!--pages/record/add-record.wxml-->
<view class="container">
  <!-- 搜索框和拍照按钮 -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="请输入食物名称" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <text class="search-icon">🔍</text>
    </view>
    <button class="camera-btn" bindtap="takePhoto">
      <text class="camera-icon">📷</text>
    </button>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 左侧菜单（真实显示） -->
    <view class="sidebar">
      <view 
        class="menu-item {{activeTab === 'recent' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="recent"
      >
        <text class="menu-text">最近</text>
      </view>
      <view 
        class="menu-item {{activeTab === 'custom' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="custom"
      >
        <text class="menu-text">自定义</text>
      </view>
      <!-- 新增：空内容测试菜单项 -->
      <view 
        class="menu-item {{activeTab === 'blank' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="blank"
      >
        <text class="menu-text">空</text>
      </view>
    </view>

    <!-- 右侧内容区域 -->
    <view class="content-area">
      <!-- 搜索结果 -->
      <view class="search-results" wx:if="{{searchResults.length > 0}}">
        <view class="section-title">搜索结果</view>
        <view class="food-list">
          <view 
            class="food-item" 
            wx:for="{{searchResults}}" 
            wx:key="id" 
            bindtap="selectFood" 
            data-food="{{item}}"
          >
            <view class="food-image">
              <text class="food-placeholder">🍽️</text>
            </view>
            <view class="food-info">
              <text class="food-name">{{item.display_name}}</text>
              <text class="food-calories">{{item.display_energy_kcal}} kcal/100g</text>
            </view>
            <view class="food-add">+</view>
          </view>
        </view>
      </view>

      <!-- 最近食物 -->
      <view class="recent-foods" wx:if="{{activeTab === 'recent' && recentFoods.length > 0 && searchResults.length === 0}}">
        <view class="section-title">最近选择</view>
        <view class="food-list">
          <view 
            class="food-item" 
            wx:for="{{recentFoods}}" 
            wx:key="id" 
            bindtap="selectFood" 
            data-food="{{item}}"
          >
            <view class="food-image">
              <text class="food-placeholder">🍽️</text>
            </view>
            <view class="food-info">
              <text class="food-name">{{item.display_name}}</text>
              <text class="food-calories">{{item.display_energy_kcal}} kcal/100g</text>
            </view>
            <view class="food-add">+</view>
          </view>
        </view>
      </view>

      <!-- 自定义食物 -->
      <view class="custom-foods" wx:if="{{activeTab === 'custom' && searchResults.length === 0}}">
        <view class="section-header">
          <text class="section-title">我的自定义食物</text>
          <view class="add-inline" bindtap="addCustomFood">
            <view class="icon-circle success small">＋</view>
            <text class="add-hint">添加自定义食物</text>
          </view>
        </view>
        
        <view class="food-list" wx:if="{{customFoods.length > 0}}">
          <view 
            class="food-item custom-food-item" 
            wx:for="{{customFoods}}" 
            wx:key="id"
            bindtap="selectFood" 
            data-food="{{item}}"
          >
            <view class="food-image">
              <image 
                wx:if="{{item.image_url}}" 
                class="food-thumbnail" 
                src="{{item.image_url}}" 
                mode="aspectFill"
              />
              <text wx:else class="food-placeholder">🍽️</text>
            </view>
            <view class="food-info">
              <text class="food-name">{{item.food_name}}</text>
              <text class="food-calories">{{item.energy_kcal}} kcal/100g</text>
            </view>
            <view class="food-actions" catchtap="stopPropagation">
              <view class="icon-circle danger" catchtap="deleteCustomFood" data-id="{{item.id}}">🗑️</view>
            </view>
          </view>
        </view>
        
        <view class="empty-state" wx:else>
          <text class="empty-text">暂无自定义食物</text>
          <text class="empty-hint">点击上方按钮添加自定义食物</text>
        </view>
      </view>

      <!-- 新增：空内容测试块 -->
      <view class="blank-content" wx:if="{{activeTab === 'blank' && searchResults.length === 0}}">
        <view class="empty-state">
          <text class="empty-text">空白测试</text>
          <text class="empty-hint">这里没有任何内容，用于排查是否内容过宽导致菜单消失</text>
        </view>
      </view>

      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{activeTab === 'recent' && recentFoods.length === 0 && searchResults.length === 0}}">
        <text class="empty-text">暂无最近选择</text>
        <text class="empty-hint">搜索并选择食物后，会显示在这里</text>
      </view>

      <!-- 搜索中状态 -->
      <view class="loading" wx:if="{{searching}}">
        <text>搜索中...</text>
      </view>
    </view>
  </view>
</view>